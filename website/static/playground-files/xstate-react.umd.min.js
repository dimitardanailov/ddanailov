!(function (t, e) {
  'object' == typeof exports && 'undefined' != typeof module
    ? e(
        exports,
        require('react'),
        require('use-isomorphic-layout-effect'),
        require('xstate'),
      )
    : 'function' == typeof define && define.amd
    ? define(['exports', 'react', 'use-isomorphic-layout-effect', 'xstate'], e)
    : e(
        ((t = t || self).XStateReact = {}),
        t.React,
        t.useIsomorphicLayoutEffect,
        t.XState,
      )
})(this, function (t, e, n, r) {
  'use strict'
  n = n && Object.prototype.hasOwnProperty.call(n, 'default') ? n.default : n
  /*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */
  var c,
    o = function () {
      return (o =
        Object.assign ||
        function (t) {
          for (var e, n = 1, r = arguments.length; n < r; n++)
            for (var c in (e = arguments[n]))
              Object.prototype.hasOwnProperty.call(e, c) && (t[c] = e[c])
          return t
        }).apply(this, arguments)
    }
  function u(t, e) {
    var n = 'function' == typeof Symbol && t[Symbol.iterator]
    if (!n) return t
    var r,
      c,
      o = n.call(t),
      u = []
    try {
      for (; (void 0 === e || e-- > 0) && !(r = o.next()).done; )
        u.push(r.value)
    } catch (t) {
      c = {error: t}
    } finally {
      try {
        r && !r.done && (n = o.return) && n.call(o)
      } finally {
        if (c) throw c.error
      }
    }
    return u
  }
  function i() {
    for (var t = [], e = 0; e < arguments.length; e++)
      t = t.concat(u(arguments[e]))
    return t
  }
  function f(t) {
    var n = e.useRef()
    return n.current || (n.current = {v: t()}), n.current.v
  }
  function a(t, e) {
    var n,
      r,
      c = u([[], []], 2),
      o = c[0],
      i = c[1]
    try {
      for (
        var f = (function (t) {
            var e = 'function' == typeof Symbol && t[Symbol.iterator],
              n = 0
            return e
              ? e.call(t)
              : {
                  next: function () {
                    return (
                      t && n >= t.length && (t = void 0),
                      {value: t && t[n++], done: !t}
                    )
                  },
                }
          })(t),
          a = f.next();
        !a.done;
        a = f.next()
      ) {
        var s = a.value
        e(s) ? o.push(s) : i.push(s)
      }
    } catch (t) {
      n = {error: t}
    } finally {
      try {
        a && !a.done && (r = f.return) && r.call(f)
      } finally {
        if (n) throw n.error
      }
    }
    return [o, i]
  }
  function s(t, e) {
    var n = function () {
      for (var e = [], n = 0; n < arguments.length; n++) e[n] = arguments[n]
      return function () {
        return t.apply(void 0, i(e))
      }
    }
    return (
      Object.defineProperties(n, {
        name: {value: 'effect:' + t.name},
        __effect: {value: e},
      }),
      n
    )
  }
  function l(t, e) {
    ;(0, t.exec)(e.context, e._event.data, {
      action: t,
      state: e,
      _event: e._event,
    })()
  }
  !(function (t) {
    ;(t[(t.Effect = 1)] = 'Effect'), (t[(t.LayoutEffect = 2)] = 'LayoutEffect')
  })(c || (c = {}))
  var v = function () {}
  function p(t, r) {
    void 0 === r &&
      (r = function (t) {
        return (function (t) {
          return 'state' in t
        })(t)
          ? t.state
          : void 0
      })
    var c = e.useRef(t),
      o = e.useRef([]),
      i = u(
        e.useState(function () {
          return r(t)
        }),
        2,
      ),
      a = i[0],
      s = i[1],
      l = f(function () {
        return function (t) {
          var e = c.current
          ;(function (t) {
            return 'deferred' in t
          })(e) && e.deferred
            ? o.current.push(t)
            : e.send(t)
        }
      })
    return (
      n(
        function () {
          ;(c.current = t), s(r(t))
          for (
            var e = t.subscribe({
              next: function (t) {
                return s(t)
              },
              error: v,
              complete: v,
            });
            o.current.length > 0;

          ) {
            var n = o.current.shift()
            t.send(n)
          }
          return function () {
            e.unsubscribe()
          }
        },
        [t],
      ),
      [a, l]
    )
  }
  ;(t.asEffect = function (t) {
    return s(t, c.Effect)
  }),
    (t.asLayoutEffect = function (t) {
      return s(t, c.LayoutEffect)
    }),
    (t.useActor = p),
    (t.useMachine = function (t, s) {
      void 0 === s && (s = {})
      var v = f(function () {
          return 'function' == typeof t ? t() : t
        }),
        p = s.context,
        y = s.guards,
        d = s.actions,
        h = s.activities,
        b = s.services,
        g = s.delays,
        x = s.state,
        m = (function (t, e) {
          var n = {}
          for (var r in t)
            Object.prototype.hasOwnProperty.call(t, r) &&
              e.indexOf(r) < 0 &&
              (n[r] = t[r])
          if (null != t && 'function' == typeof Object.getOwnPropertySymbols) {
            var c = 0
            for (r = Object.getOwnPropertySymbols(t); c < r.length; c++)
              e.indexOf(r[c]) < 0 &&
                Object.prototype.propertyIsEnumerable.call(t, r[c]) &&
                (n[r[c]] = t[r[c]])
          }
          return n
        })(s, [
          'context',
          'guards',
          'actions',
          'activities',
          'services',
          'delays',
          'state',
        ]),
        O = u(
          f(function () {
            var t = {
                context: p,
                guards: y,
                actions: d,
                activities: h,
                services: b,
                delays: g,
              },
              e = v.withConfig(t, o(o({}, v.context), p))
            return [e, r.interpret(e, o({deferEvents: !0}, m))]
          }),
          2,
        ),
        E = O[0],
        S = O[1],
        j = u(
          e.useState(function () {
            var t = E.initialState
            return x ? r.State.create(x) : t
          }),
          2,
        ),
        _ = j[0],
        w = j[1],
        P = e.useRef([]),
        R = e.useRef([])
      return (
        n(function () {
          return (
            S.onTransition(function (t) {
              var e,
                n,
                r = void 0 === t.changed && Object.keys(t.children).length
              if (((t.changed || r) && w(t), t.actions.length)) {
                var o = u(
                    a(
                      t.actions.filter(function (t) {
                        return (
                          'function' == typeof t.exec && '__effect' in t.exec
                        )
                      }),
                      function (t) {
                        return t.exec.__effect === c.Effect
                      },
                    ),
                    2,
                  ),
                  f = o[0],
                  s = o[1]
                ;(e = P.current).push.apply(
                  e,
                  i(
                    f.map(function (e) {
                      return [e, t]
                    }),
                  ),
                ),
                  (n = R.current).push.apply(
                    n,
                    i(
                      s.map(function (e) {
                        return [e, t]
                      }),
                    ),
                  )
              }
            }).start(x ? r.State.create(x) : void 0),
            function () {
              S.stop()
            }
          )
        }, []),
        e.useEffect(
          function () {
            Object.assign(S.machine.options.actions, d)
          },
          [d],
        ),
        e.useEffect(
          function () {
            Object.assign(S.machine.options.services, b)
          },
          [b],
        ),
        n(
          function () {
            for (; R.current.length; ) {
              var t = u(R.current.shift(), 2)
              l(t[0], t[1])
            }
          },
          [_],
        ),
        e.useEffect(
          function () {
            for (; P.current.length; ) {
              var t = u(P.current.shift(), 2)
              l(t[0], t[1])
            }
          },
          [_],
        ),
        [_, S.send, S]
      )
    }),
    (t.useService = function (t) {
      return [
        u(
          p(t, function () {
            return 0 !== ('status' in t ? t.status : t._status)
              ? t.state
              : t.machine.initialState
          }),
          1,
        )[0],
        t.send,
      ]
    }),
    Object.defineProperty(t, '__esModule', {value: !0})
})
